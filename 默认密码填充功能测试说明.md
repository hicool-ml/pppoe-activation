# 默认密码填充功能测试说明

## 容器状态
- **容器ID**: c70c72fab01d
- **状态**: Up 13 seconds (healthy) ✅
- **访问地址**: http://localhost:80/

---

## 功能说明

### 默认密码填充逻辑

#### 1. 中国移动（cmccgx）
- **原始密码模式**：自动填充手机号后6位
- **修改过密码模式**：不自动填充，提示用户输入新密码
- **触发条件**：
  - 账号长度 ≥ 6位
  - 密码框为空（防止覆盖用户手动输入的密码）

#### 2. 中国电信（96301）
- **自动填充**：手机号后8位
- **触发条件**：
  - 账号长度 ≥ 8位
  - 密码框为空（防止覆盖用户手动输入的密码）

#### 3. 中国联通（10010）
- **不自动填充**：提示"默认密码通常为身份证后6位"
- **原因**：联通的默认密码不是基于手机号的

#### 4. 校园网（cdu）
- **不自动填充**：提示"请输入统一身份认证系统的登录密码"
- **原因**：校园网使用统一身份认证密码，无法自动生成

#### 5. 直拨（direct）
- **不自动填充**：提示"请输入该PPPoE账号对应的密码"
- **原因**：直拨模式使用自定义账号，无法自动生成密码

---

## 测试步骤

### 测试1：中国移动默认密码填充

#### 步骤1：先输入账号，后选择ISP
1. 在账号框输入：`13812345678`
2. 选择运营商：`中国移动`
3. 选择账号类型：`原始密码`
4. ✅ **预期结果**：密码框自动填充为 `5678`

#### 步骤2：先选择ISP，后输入账号
1. 选择运营商：`中国移动`
2. 选择账号类型：`原始密码`
3. 在账号框输入：`13812345678`
4. ✅ **预期结果**：密码框自动填充为 `5678`

#### 步骤3：防止覆盖用户手动输入的密码
1. 选择运营商：`中国移动`
2. 选择账号类型：`原始密码`
3. 在账号框输入：`13812345678`
4. 密码框自动填充为 `5678`
5. 手动修改密码为：`123456`
6. 继续在账号框输入或修改账号
7. ✅ **预期结果**：密码框保持为 `123456`，不会被覆盖

#### 步骤4：ISP切换时清空密码
1. 选择运营商：`中国移动`
2. 在账号框输入：`13812345678`
3. 密码框自动填充为 `5678`
4. 切换运营商到：`中国电信`
5. ✅ **预期结果**：密码框被清空

---

### 测试2：中国电信默认密码填充

#### 步骤1：先输入账号，后选择ISP
1. 在账号框输入：`13812345678`
2. 选择运营商：`中国电信`
3. ✅ **预期结果**：密码框自动填充为 `2345678`

#### 步骤2：先选择ISP，后输入账号
1. 选择运营商：`中国电信`
2. 在账号框输入：`13812345678`
3. ✅ **预期结果**：密码框自动填充为 `2345678`

---

### 测试3：移动修改过密码模式

#### 步骤1：修改过密码模式不自动填充
1. 选择运营商：`中国移动`
2. 选择账号类型：`修改过密码`
3. 在账号框输入：`13812345678`
4. ✅ **预期结果**：密码框保持为空，提示"请输入新密码"

---

### 测试4：中国联通不自动填充

#### 步骤1：联通提示默认密码
1. 选择运营商：`中国联通`
2. 在账号框输入：`13812345678`
3. ✅ **预期结果**：密码框保持为空，提示"默认密码通常为身份证后6位，如已修改请填写实际密码"

---

### 测试5：校园网不自动填充

#### 步骤1：校园网提示统一身份认证密码
1. 选择运营商：`校园网（学工号）`
2. 在账号框输入：`2021001`
3. ✅ **预期结果**：密码框保持为空，提示"请输入统一身份认证系统的登录密码"

---

## 关键修复说明

### 修复1：ISP切换时清空密码
**问题**：切换ISP后，旧的密码仍然保留，可能导致混淆。
**修复**：在ISP切换事件中添加 `passwordInput.value = "";`
**效果**：切换ISP时自动清空密码框，避免混淆。

### 修复2：防止覆盖用户手动输入的密码
**问题**：用户手动输入密码后，输入账号时会被自动填充覆盖。
**修复**：添加 `const shouldAutoFill = passwordInput.value === "";` 检查
**效果**：只有当密码框为空时才自动填充默认密码，保护用户手动输入的密码。

---

## 代码逻辑

### updatePasswordHint() 函数
```javascript
function updatePasswordHint() {
  const messages = I18N[currentLang] || I18N['zh'];
  const isp = ispSelect.value;
  const baseUser = usernameInput.value.trim();

  // 清空提示文本
  passwordHint.textContent = "";

  if (!isp) return;

  // 防止覆盖用户已手动输入的密码
  const shouldAutoFill = passwordInput.value === "";

  if (isp === "cdu") {
    passwordHint.textContent = messages.password_hint_cdu;
  } else if (isp === "cmccgx") {
    const cmccType = document.querySelector('input[name="cmccType"]:checked')?.value;
    if (cmccType === "normal") {
      // 只有当密码框为空时才自动填充
      if (baseUser.length >= 6 && shouldAutoFill) {
        passwordInput.value = baseUser.slice(-6);
      }
      passwordHint.textContent = messages.password_hint_cmcc_normal;
    } else {
      passwordHint.textContent = messages.password_hint_cmcc_modified;
    }
  } else if (isp === "96301") {
    // 只有当密码框为空时才自动填充
    if (baseUser.length >= 8 && shouldAutoFill) {
      passwordInput.value = baseUser.slice(-8);
    }
    passwordHint.textContent = messages.password_hint_telecom;
  } else if (isp === "10010") {
    passwordHint.textContent = messages.password_hint_unicom;
  } else if (isp === "direct") {
    passwordHint.textContent = messages.password_hint_direct;
  }
}
```

### ISP切换事件
```javascript
ispSelect.addEventListener('change', () => {
  const isp = ispSelect.value;

  // ISP切换时清空密码（重要！）
  passwordInput.value = "";

  // 显示/隐藏移动选项
  if (isp === "cmccgx") {
    cmccOptions.classList.remove('hidden');
  } else {
    cmccOptions.classList.add('hidden');
  }

  // 显示/隐藏修改密码按钮
  if (["cdu", "cmccgx", "10010", "96301"].includes(isp)) {
    changePwdBtn.classList.remove('hidden');
  } else {
    changePwdBtn.classList.add('hidden');
  }

  updateUsernameLabel();
  updatePreview();
  updatePasswordHint();
});
```

### 账号输入事件
```javascript
usernameInput.addEventListener('input', () => {
  updatePreview();
  updatePasswordHint();
});
```

---

## 总结

### ✅ 已修复的问题
1. **ISP切换时清空密码**：避免混淆
2. **防止覆盖用户手动输入的密码**：保护用户输入

### ✅ 默认密码填充逻辑
1. **中国移动（原始密码模式）**：手机号后6位
2. **中国电信**：手机号后8位
3. **中国联通**：不自动填充，提示身份证后6位
4. **校园网**：不自动填充，提示统一身份认证密码
5. **直拨**：不自动填充，提示输入PPPoE账号密码

### ✅ 触发条件
- 账号长度足够（移动≥6位，电信≥8位）
- 密码框为空（防止覆盖用户手动输入的密码）

---

## 测试建议
请按照上述测试步骤逐一测试，确认所有功能都正常工作。如果发现任何问题，请及时反馈。
