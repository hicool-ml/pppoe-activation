# PPPOE æ¿€æ´»ç³»ç»Ÿ - å…¨æ–°å®¿ä¸»æœºéƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨å…¨æ–°çš„ Linux æœåŠ¡å™¨ä¸Šä»é›¶å¼€å§‹éƒ¨ç½² PPPOE æ¿€æ´»ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¼€æœºè‡ªå¯ã€æ•°æ®åº“åˆå§‹åŒ–å’ŒæŒä¹…åŒ–é…ç½®ã€‚

## ç›®å½•

1. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
2. [å®‰è£… Docker](#å®‰è£…-docker)
3. [è·å–æºä»£ç ](#è·å–æºä»£ç )
4. [æ„å»º Docker é•œåƒ](#æ„å»º-docker-é•œåƒ)
5. [åˆ›å»ºæŒä¹…åŒ–ç›®å½•](#åˆ›å»ºæŒä¹…åŒ–ç›®å½•)
6. [å¯åŠ¨å®¹å™¨ï¼ˆå¼€æœºè‡ªå¯ï¼‰](#å¯åŠ¨å®¹å™¨å¼€æœºè‡ªå¯)
7. [åˆå§‹åŒ–æ•°æ®åº“é…ç½®](#åˆå§‹åŒ–æ•°æ®åº“é…ç½®)
8. [é…ç½®ç½‘ç»œæ¨¡å¼](#é…ç½®ç½‘ç»œæ¨¡å¼)
9. [éªŒè¯éƒ¨ç½²](#éªŒè¯éƒ¨ç½²)
10. [æŒä¹…åŒ–é…ç½®è¯´æ˜](#æŒä¹…åŒ–é…ç½®è¯´æ˜)
11. [å¼€æœºè‡ªå¯éªŒè¯](#å¼€æœºè‡ªå¯éªŒè¯)
12. [ç¦»çº¿éƒ¨ç½²å®Œæ•´æµç¨‹](#ç¦»çº¿éƒ¨ç½²å®Œæ•´æµç¨‹)

## ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

- **CPU**ï¼šåŒæ ¸åŠä»¥ä¸Š
- **å†…å­˜**ï¼š2GB åŠä»¥ä¸Šï¼ˆæ¨è 4GBï¼‰
- **ç¡¬ç›˜**ï¼š10GB åŠä»¥ä¸Šå¯ç”¨ç©ºé—´
- **ç½‘å¡**ï¼šè‡³å°‘ä¸€ä¸ªç½‘ç»œæ¥å£ç”¨äº PPPOE æ‹¨å·

### è½¯ä»¶è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šLinuxï¼ˆæ¨è Ubuntu 20.04+ / Debian 11+ï¼‰
- **Docker**ï¼š20.10 åŠä»¥ä¸Š
- **Python**ï¼š3.12ï¼ˆå®¹å™¨å†…ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…ï¼‰

## å®‰è£… Docker

### Ubuntu / Debian

```bash
# 1. æ›´æ–°ç³»ç»ŸåŒ…
sudo apt update
sudo apt upgrade -y

# 2. å®‰è£…å¿…è¦çš„åŒ…
sudo apt install -y \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

# 3. æ·»åŠ  Docker å®˜æ–¹ GPG å¯†é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

# 4. è®¾ç½® Docker ä»“åº“
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 5. å®‰è£… Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin

# 6. å¯åŠ¨ Docker æœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# 7. éªŒè¯å®‰è£…
sudo docker --version
```

### éªŒè¯ Docker å®‰è£…

```bash
# æµ‹è¯• Docker æ˜¯å¦æ­£å¸¸å·¥ä½œ
sudo docker run hello-world

# æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯
sudo docker --version
```

## è·å–æºä»£ç 

### æ–¹æ³• 1ï¼šä½¿ç”¨ Gitï¼ˆéœ€è¦ç½‘ç»œï¼‰

```bash
# 1. å®‰è£… Git
sudo apt install -y git

# 2. å…‹éš†ä»“åº“
git clone https://github.com/hicool-ml/pppoe-activation.git

# 3. è¿›å…¥é¡¹ç›®ç›®å½•
cd pppoe-activation
```

### æ–¹æ³• 2ï¼šä¸‹è½½å‹ç¼©åŒ…ï¼ˆéœ€è¦ç½‘ç»œï¼‰

```bash
# 1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬
wget https://github.com/hicool-ml/pppoe-activation/archive/refs/heads/main.zip

# 2. è§£å‹
unzip main.zip

# 3. è¿›å…¥é¡¹ç›®ç›®å½•
cd pppoe-activation-main

# 4. é‡å‘½åç›®å½•
mv pppoe-activation-main pppoe-activation
cd pppoe-activation
```

### æ–¹æ³• 3ï¼šä½¿ç”¨æœ¬åœ°æºä»£ç åŒ…ï¼ˆæ— éœ€ç½‘ç»œï¼‰

å¦‚æœæ‚¨å·²ç»æœ‰æºä»£ç å‹ç¼©åŒ…æˆ–å¤‡ä»½æ–‡ä»¶ï¼š

```bash
# 1. è§£å‹æºä»£ç åŒ…
tar -xzf pppoe-activation-source.tar.gz
# æˆ–
unzip pppoe-activation-source.zip

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd pppoe-activation
```

**å¦‚ä½•åˆ›å»ºæºä»£ç åŒ…**ï¼š

åœ¨å·²æœ‰æºä»£ç çš„æœºå™¨ä¸Šæ‰§è¡Œï¼š

```bash
# æ‰“åŒ…æºä»£ç 
tar -czf pppoe-activation-source.tar.gz pppoe-activation/

# æˆ–ä½¿ç”¨ zip
zip -r pppoe-activation-source.zip pppoe-activation/

# ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨
scp pppoe-activation-source.tar.gz user@target-server:/tmp/
```

## æ„å»º Docker é•œåƒ

### æ–¹æ³• 1ï¼šåœ¨æœ¬åœ°æ„å»ºé•œåƒï¼ˆéœ€è¦ç½‘ç»œï¼‰

```bash
# åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ
docker build -t pppoe-activation:latest .

# æŸ¥çœ‹é•œåƒ
docker images | grep pppoe-activation
```

### æ–¹æ³• 2ï¼šä½¿ç”¨æœ¬åœ°é•œåƒæ–‡ä»¶ï¼ˆæ— éœ€ç½‘ç»œï¼‰

å¦‚æœæ‚¨å·²ç»æœ‰ä¸€ä¸ªæ„å»ºå¥½çš„é•œåƒæ–‡ä»¶ï¼ˆ`.tar` æ ¼å¼ï¼‰ï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥ä½¿ç”¨ï¼š

```bash
# 1. å¯¼å…¥æœ¬åœ°é•œåƒ
docker load -i pppoe-activation-image.tar

# 2. æŸ¥çœ‹å¯¼å…¥çš„é•œåƒ
docker images | grep pppoe-activation

# 3. ï¼ˆå¯é€‰ï¼‰é‡å‘½åé•œåƒ
docker tag pppoe-activation:latest pppoe-activation:latest
```

**å¦‚ä½•è·å–æœ¬åœ°é•œåƒæ–‡ä»¶**ï¼š

åœ¨å·²ç»æ„å»ºå¥½é•œåƒçš„æœºå™¨ä¸Šæ‰§è¡Œï¼š

```bash
# å¯¼å‡ºé•œåƒä¸º tar æ–‡ä»¶
docker save -o pppoe-activation-image.tar pppoe-activation:latest

# æŸ¥çœ‹æ–‡ä»¶å¤§å°
ls -lh pppoe-activation-image.tar

# ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼ˆä½¿ç”¨ scpã€U ç›˜ç­‰æ–¹å¼ï¼‰
scp pppoe-activation-image.tar user@target-server:/tmp/
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€ç½‘ç»œè¿æ¥
- âœ… éƒ¨ç½²é€Ÿåº¦å¿«
- âœ… é€‚åˆç¦»çº¿ç¯å¢ƒ
- âœ… é•œåƒç‰ˆæœ¬å¯æ§

## åˆ›å»ºæŒä¹…åŒ–ç›®å½•

```bash
# åˆ›å»ºæŒä¹…åŒ–ç›®å½•
mkdir -p logs data instance

# æŸ¥çœ‹ç›®å½•ç»“æ„
ls -la
```

**ç›®å½•è¯´æ˜**ï¼š
- `logs/` - å­˜æ”¾æ‰€æœ‰æ‹¨å·æ—¥å¿—
- `data/` - å­˜æ”¾è¿è¡Œæ—¶æ•°æ®
- `instance/` - å­˜æ”¾æ•°æ®åº“æ–‡ä»¶

### éªŒè¯æŒä¹…åŒ–ç›®å½•æƒé™

ç¡®ä¿å½“å‰ç”¨æˆ·å¯¹æŒä¹…åŒ–ç›®å½•æœ‰è¯»å†™æƒé™ï¼ˆDocker å®¹å™¨å†…è¿›ç¨‹é€šå¸¸ä»¥ root æˆ–ç‰¹å®š UID è¿è¡Œï¼‰ï¼š

```bash
# è®¾ç½®å®½æ¾æƒé™ï¼ˆç”Ÿäº§ç¯å¢ƒå¯æŒ‰éœ€æ”¶ç´§ï¼‰
chmod -R 777 logs data instance

# æˆ–æ›´å®‰å…¨çš„æ–¹å¼ï¼šè®©å®¹å™¨å†…ç”¨æˆ·åŒ¹é…å®¿ä¸»æœº UIDï¼ˆå¦‚æœçŸ¥é“ï¼‰
# ä¾‹å¦‚å®¹å™¨å†…åº”ç”¨ä½¿ç”¨ UID 1000ï¼Œåˆ™ï¼š
# chown -R 1000:1000 instance/
```

> ğŸ’¡ **è‹¥å®¹å™¨å†…åº”ç”¨ä»¥é root ç”¨æˆ·è¿è¡Œä¸”æ— å†™æƒé™ï¼Œä¼šå¯¼è‡´æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥æˆ–æ—¥å¿—æ— æ³•å†™å…¥ã€‚**

> ğŸ’¡ **SELinux ç”¨æˆ·æ³¨æ„**ï¼š
> åœ¨ CentOS/RHEL/Fedora ä¸Šï¼Œè‹¥å¯ç”¨ SELinuxï¼Œéœ€åœ¨æŒ‚è½½å‚æ•°åæ·»åŠ  `:z` æˆ– `:Z` æ ‡ç­¾ï¼š
> ```bash
> -v ${PWD}/instance:/opt/pppoe-activation/instance:Z
> ```
> Ubuntu é»˜è®¤ä½¿ç”¨ AppArmorï¼Œé€šå¸¸æ— éœ€é¢å¤–é…ç½®ã€‚

## å¯åŠ¨å®¹å™¨ï¼ˆå¼€æœºè‡ªå¯ï¼‰

### å¯åŠ¨å®¹å™¨

```bash
# å¯åŠ¨å®¹å™¨ï¼ˆé…ç½®å¼€æœºè‡ªå¯ï¼‰
docker run -d --name pppoe-activation \
  --restart=unless-stopped \
  --device=/dev/ppp \
  --cap-add=NET_ADMIN \
  -p 80:80 \
  -p 8081:8081 \
  -p 9999:9999 \
  -v ${PWD}/logs:/opt/pppoe-activation/logs \
  -v ${PWD}/data:/opt/pppoe-activation/data \
  -v ${PWD}/instance:/opt/pppoe-activation/instance \
  --network=host \
  pppoe-activation:latest

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep pppoe-activation
```

> âš ï¸ **æ³¨æ„ï¼š`--restart=unless-stopped` ç”Ÿæ•ˆçš„å‰ææ˜¯ `docker` æœåŠ¡å·²å¯ç”¨å¼€æœºè‡ªå¯ï¼**
>
> å¦‚æœæœªæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®¿ä¸»æœºé‡å¯å Docker å¼•æ“ä¸ä¼šå¯åŠ¨ï¼Œå®¹å™¨è‡ªç„¶ä¹Ÿæ— æ³•æ¢å¤ï¼š
> ```bash
> sudo systemctl enable docker
> ```
>
> è¯·åŠ¡å¿…åœ¨å®‰è£… Docker åæ‰§è¡Œæ­¤æ“ä½œï¼ˆå·²åœ¨[å®‰è£… Docker](#å®‰è£…-docker)ç« èŠ‚ç¬¬6æ­¥åŒ…å«ï¼‰ã€‚

### å¯åŠ¨å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ |
|------|------|
| `--name pppoe-activation` | å®¹å™¨åç§° |
| `--restart=unless-stopped` | **å¼€æœºè‡ªå¯**ï¼šå®¿ä¸»æœºé‡å¯åè‡ªåŠ¨å¯åŠ¨å®¹å™¨ |
| `--device=/dev/ppp` | **æ˜ å°„ PPP è®¾å¤‡åˆ°å®¹å™¨**ï¼špppd æ‹¨å·å¿…éœ€ |
| `--cap-add=NET_ADMIN` | **æ·»åŠ ç½‘ç»œç®¡ç†æƒé™**ï¼šåˆ›å»º VLAN å­æ¥å£å¿…éœ€ |
| `-p 80:80` | æ˜ å°„ç«¯å£ 80ï¼ˆç”¨æˆ·æ¿€æ´»é¡µé¢ï¼‰ |
| `-p 8081:8081` | æ˜ å°„ç«¯å£ 8081ï¼ˆç®¡ç†åå°ï¼‰ |
| `-p 9999:9999` | æ˜ å°„ç«¯å£ 9999ï¼ˆé…ç½®ç®¡ç†ï¼‰ |
| `-v ${PWD}/logs:...` | **æŒä¹…åŒ–æ—¥å¿—**ï¼šæ—¥å¿—ç›®å½•æŒ‚è½½ |
| `-v ${PWD}/data:...` | **æŒä¹…åŒ–æ•°æ®**ï¼šæ•°æ®ç›®å½•æŒ‚è½½ |
| `-v ${PWD}/instance:...` | **æŒä¹…åŒ–æ•°æ®åº“**ï¼šæ•°æ®åº“ç›®å½•æŒ‚è½½ |
| `--network=host` | ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œï¼ˆæé«˜ç½‘ç»œæ€§èƒ½ï¼‰ |

> âš ï¸ **é‡è¦æƒé™è¯´æ˜**ï¼š
> - `--device=/dev/ppp`ï¼š**å¿…éœ€**ï¼Œpppd æ‹¨å·éœ€è¦è®¿é—® PPP è®¾å¤‡ã€‚å¦‚æœæ²¡æœ‰æ­¤å‚æ•°ï¼Œæ‹¨å·ä¼šå¤±è´¥å¹¶æç¤º"Cannot find /dev/ppp"ã€‚
> - `--cap-add=NET_ADMIN`ï¼š**å¿…éœ€**ï¼Œåˆ›å»º VLAN å­æ¥å£éœ€è¦ç½‘ç»œç®¡ç†æƒé™ã€‚å¦‚æœæ²¡æœ‰æ­¤å‚æ•°ï¼Œæ— æ³•åˆ›å»º VLAN å­æ¥å£ã€‚

### å¼€æœºè‡ªå¯è¯´æ˜

å®¹å™¨é…ç½®äº† `--restart=unless-stopped` ç­–ç•¥ï¼Œè¿™æ„å‘³ç€ï¼š
- âœ… å®¿ä¸»æœºé‡å¯åï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å¯åŠ¨
- âœ… Docker æœåŠ¡é‡å¯åï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å¯åŠ¨
- âœ… å®¹å™¨å´©æºƒåï¼Œä¼šè‡ªåŠ¨é‡å¯
- âš ï¸ å¦‚æœå®¹å™¨è¢«æ‰‹åŠ¨åœæ­¢ï¼ˆ`docker stop`ï¼‰ï¼Œåˆ™ä¸ä¼šè‡ªåŠ¨å¯åŠ¨

## åˆå§‹åŒ–æ•°æ®åº“é…ç½®

### è®¿é—®é…ç½®é¡µé¢

```bash
# æ‰“å¼€æµè§ˆå™¨è®¿é—®
http://æœåŠ¡å™¨IP:9999
```

### é…ç½®æ­¥éª¤

1. **é€‰æ‹©ç½‘ç»œæ¨¡å¼**
   - æ™®é€šæ¨¡å¼ï¼šç›´æ¥ä½¿ç”¨ç‰©ç†ç½‘å¡
   - VLAN æ¨¡å¼ï¼šä½¿ç”¨ VLAN å­æ¥å£

2. **é…ç½®ç½‘ç»œæ¥å£**
   - æ™®é€šæ¨¡å¼ï¼šé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†ç½‘å¡
   - VLAN æ¨¡å¼ï¼šé€‰æ‹©åŸºç¡€ç½‘å¡å’Œ VLAN ID

3. **é…ç½®æŒä¹…åŒ–å­˜å‚¨è·¯å¾„**
   - æ—¥å¿—ç›®å½•ï¼š`./logs`
   - æ•°æ®ç›®å½•ï¼š`./data`
   - æ•°æ®åº“ç›®å½•ï¼š`./instance`

4. **æäº¤é…ç½®**
   - ç‚¹å‡»"ä¿å­˜é…ç½®"æŒ‰é’®
   - ç­‰å¾…é…ç½®å®Œæˆ

### æ•°æ®åº“è‡ªåŠ¨åˆå§‹åŒ–

å®¹å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨ï¼š
- å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå¹¶åˆå§‹åŒ–
- å¦‚æœæ•°æ®åº“å·²å­˜åœ¨ï¼Œä¼šè·³è¿‡åˆå§‹åŒ–

æ•°æ®åº“æ–‡ä»¶ä½ç½®ï¼š`instance/database.db`

## é…ç½®ç½‘ç»œæ¨¡å¼

### æ™®é€šæ¨¡å¼

**é€‚ç”¨åœºæ™¯**ï¼šå•ç½‘å¡æˆ–å¤šç½‘å¡ç›´æ¥æ‹¨å·

**é…ç½®æ–¹æ³•**ï¼š
1. åœ¨é…ç½®é¡µé¢é€‰æ‹©"æ™®é€šæ¨¡å¼"
2. é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†ç½‘å¡
3. ä¿å­˜é…ç½®

**ç¤ºä¾‹**ï¼š
```
ç½‘å¡åˆ—è¡¨ï¼šenp7s0, enp3s0, enp4s0
```

### VLAN æ¨¡å¼

**é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦é€šè¿‡ VLAN å­æ¥å£æ‹¨å·

**é…ç½®æ–¹æ³•**ï¼š
1. åœ¨é…ç½®é¡µé¢é€‰æ‹©"VLAN æ¨¡å¼"
2. é€‰æ‹©åŸºç¡€ç½‘å¡ï¼ˆå¦‚ enp7s0ï¼‰
3. è¾“å…¥ VLAN ID

**VLAN ID æ”¯æŒå¤šç§æ ¼å¼**ï¼š
- å•ä¸ª VLANï¼š`2000`
- å¤šä¸ª VLANï¼ˆé€—å·åˆ†éš”ï¼‰ï¼š`2000,2001,2002`
- VLAN èŒƒå›´ï¼š`2000-2005`
- æ··åˆæ ¼å¼ï¼š`2000,2001,2005-2010,2015`

**ç¤ºä¾‹**ï¼š
```
åŸºç¡€ç½‘å¡ï¼šenp7s0
VLAN IDï¼š2000,2001,2002,2003,2004,2005
```

## éªŒè¯éƒ¨ç½²

### æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep pppoe-activation

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡º
# pppoe-activation   Up   5 minutes ago   (healthy)
```

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—

```bash
# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker logs pppoe-activation

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f pppoe-activation
```

### æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åˆ›å»º
ls -lh instance/database.db

# æ£€æŸ¥æ•°æ®åº“æƒé™
ls -l instance/database.db
```

### æ£€æŸ¥æŒä¹…åŒ–ç›®å½•

```bash
# æ£€æŸ¥æ—¥å¿—ç›®å½•
ls -la logs/

# æ£€æŸ¥æ•°æ®ç›®å½•
ls -la data/

# æ£€æŸ¥æ•°æ®åº“ç›®å½•
ls -la instance/
```

### æ£€æŸ¥å®¹å™¨æŒ‚è½½è¯¦æƒ…

```bash
# æŸ¥çœ‹å®¹å™¨æŒ‚è½½ä¿¡æ¯
docker inspect pppoe-activation --format '{{ json .Mounts }}' | python3 -m json.tool
```

âœ… **æ­£ç¡®è¾“å‡ºåº”æ˜¾ç¤ºç±»ä¼¼**ï¼š

```json
[
  {
    "Type": "bind",
    "Source": "/home/user/pppoe-activation/instance",
    "Destination": "/opt/pppoe-activation/instance",
    "Mode": "",
    "RW": true,
    "Propagation": "rprivate"
  },
  {
    "Type": "bind",
    "Source": "/home/user/pppoe-activation/logs",
    "Destination": "/opt/pppoe-activation/logs",
    "Mode": "",
    "RW": true,
    "Propagation": "rprivate"
  },
  {
    "Type": "bind",
    "Source": "/home/user/pppoe-activation/data",
    "Destination": "/opt/pppoe-activation/data",
    "Mode": "",
    "RW": true,
    "Propagation": "rprivate"
  }
]
```

**éªŒè¯è¦ç‚¹**ï¼š
- `Type` åº”ä¸º `"bind"`ï¼ˆè¡¨ç¤ºç»‘å®šæŒ‚è½½ï¼ŒéåŒ¿åå·ï¼‰
- `Source` åº”ä¸ºä½ çš„å®¿ä¸»æœºç»å¯¹è·¯å¾„
- `RW` åº”ä¸º `true`ï¼ˆå¯è¯»å†™ï¼‰

### è®¿é—®æœåŠ¡

```bash
# ç”¨æˆ·æ¿€æ´»é¡µé¢
http://æœåŠ¡å™¨IP:80/
http://æœåŠ¡å™¨IP/

# ç®¡ç†åå°é¡µé¢
http://æœåŠ¡å™¨IP:8081/
http://æœåŠ¡å™¨IP:8081/dashboard

# é…ç½®ç®¡ç†é¡µé¢
http://æœåŠ¡å™¨IP:9999/
```

### é»˜è®¤è´¦å·

**è¶…çº§ç®¡ç†å‘˜**ï¼š
- ç”¨æˆ·åï¼š`root`
- å¯†ç ï¼š`root123`

**æ™®é€šç®¡ç†å‘˜**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

**é‡è¦**ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç ï¼

## æŒä¹…åŒ–é…ç½®è¯´æ˜

### æŒä¹…åŒ–ç›®å½•ç»“æ„

```
pppoe-activation/
â”œâ”€â”€ logs/              # æŒä¹…åŒ–æ—¥å¿—ç›®å½•
â”‚   â””â”€â”€ *.log          # æ‹¨å·æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ data/              # æŒä¹…åŒ–æ•°æ®ç›®å½•
â””â”€â”€ instance/          # æŒä¹…åŒ–æ•°æ®åº“ç›®å½•
    â””â”€â”€ database.db     # SQLite æ•°æ®åº“æ–‡ä»¶
```

### æŒä¹…åŒ–è¯´æ˜

1. **æ—¥å¿—æŒä¹…åŒ–**
   - æ‰€æœ‰æ‹¨å·æ—¥å¿—éƒ½ä¼šä¿å­˜åˆ°å®¿ä¸»æœºçš„ `logs/` ç›®å½•
   - å³ä½¿å®¹å™¨è¢«åˆ é™¤ï¼Œæ—¥å¿—ä¹Ÿä¸ä¼šä¸¢å¤±
   - å¯ä»¥ä½¿ç”¨ `./backup.sh` è„šæœ¬å¤‡ä»½æ‰€æœ‰æ•°æ®

2. **æ•°æ®åº“æŒä¹…åŒ–**
   - æ•°æ®åº“æ–‡ä»¶ä¿å­˜åœ¨å®¿ä¸»æœºçš„ `instance/database.db`
   - æ‰€æœ‰ç®¡ç†å‘˜è´¦å·ã€ç½‘ç»œé…ç½®ã€æ¿€æ´»æ—¥å¿—éƒ½å­˜å‚¨åœ¨æ•°æ®åº“ä¸­
   - å®¹å™¨é‡å¯åæ•°æ®ä¸ä¼šä¸¢å¤±

3. **æ•°æ®æŒä¹…åŒ–**
   - è¿è¡Œæ—¶æ•°æ®ä¿å­˜åœ¨å®¿ä¸»æœºçš„ `data/` ç›®å½•
   - å¯ä»¥å­˜å‚¨ä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜æ•°æ®

### æŒä¹…åŒ–éªŒè¯

```bash
# åœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹æŒä¹…åŒ–æ–‡ä»¶
ls -la logs/
ls -la instance/database.db
ls -la data/

# åœ¨å®¹å™¨å†…æŸ¥çœ‹æŒä¹…åŒ–æ–‡ä»¶
docker exec pppoe-activation ls -la /opt/pppoe-activation/logs/
docker exec pppoe-activation ls -la /opt/pppoe-activation/instance/
docker exec pppoe-activation ls -la /opt/pppoe-activation/data/
```

### ä¸»åŠ¨æŒä¹…åŒ–éªŒè¯ï¼ˆæ¨èæ‰§è¡Œï¼‰

ä¸ºäº†ç¡®ä¿æŒä¹…åŒ–é…ç½®çœŸæ­£ç”Ÿæ•ˆï¼Œå»ºè®®æ‰§è¡Œä»¥ä¸‹éªŒè¯æµç¨‹ï¼š

#### 1. ä¿®æ”¹ç³»ç»Ÿæ•°æ®

ç™»å½•ç®¡ç†åå°ï¼ˆ`http://IP:8081`ï¼‰ï¼Œä¿®æ”¹ä¸€ä¸ªç®¡ç†å‘˜å¯†ç æˆ–æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨æˆ·ã€‚

#### 2. é‡å¯å®¿ä¸»æœº

```bash
sudo reboot
```

#### 3. é‡å¯åéªŒè¯

```bash
# ç­‰å¾…ç³»ç»Ÿå¯åŠ¨å®Œæˆåï¼Œæ£€æŸ¥å®¹å™¨æ˜¯å¦è‡ªåŠ¨è¿è¡Œ
docker ps -f name=pppoe-activation

# åº”è¯¥çœ‹åˆ°å®¹å™¨æ­£åœ¨è¿è¡Œ
# pppoe-activation   Up   1 minutes ago   (healthy)

# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -l instance/database.db

# ä½¿ç”¨æ–°å¯†ç ç™»å½•ç®¡ç†åå°
# http://IP:8081
# âœ… å¦‚æœèƒ½æˆåŠŸç™»å½•ï¼Œè¯´æ˜æŒä¹…åŒ–é…ç½®æœ‰æ•ˆ
```

**éªŒè¯è¦ç‚¹**ï¼š
- âœ… å®¹å™¨è‡ªåŠ¨å¯åŠ¨ï¼š`docker ps` æ˜¾ç¤ºå®¹å™¨æ­£åœ¨è¿è¡Œ
- âœ… æ•°æ®ä¿ç•™ï¼šä½¿ç”¨æ–°å¯†ç èƒ½æˆåŠŸç™»å½•
- âœ… æ•°æ®åº“æ–‡ä»¶å­˜åœ¨ï¼š`instance/database.db` æ–‡ä»¶å­˜åœ¨ä¸”æœ‰å†…å®¹

## å¼€æœºè‡ªå¯éªŒè¯

### é‡å¯å®¿ä¸»æœº

```bash
# é‡å¯å®¿ä¸»æœº
sudo reboot
```

### éªŒè¯å®¹å™¨è‡ªåŠ¨å¯åŠ¨

é‡å¯åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š

```bash
# ç­‰å¾…ç³»ç»Ÿå¯åŠ¨å®Œæˆå
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep pppoe-activation

# åº”è¯¥çœ‹åˆ°å®¹å™¨æ­£åœ¨è¿è¡Œ
# pppoe-activation   Up   1 minutes ago   (healthy)
```

### éªŒè¯æœåŠ¡å¯ç”¨æ€§

```bash
# æµ‹è¯•ç”¨æˆ·æ¿€æ´»é¡µé¢
curl http://localhost:80/

# æµ‹è¯•ç®¡ç†åå°
curl http://localhost:8081/

# æµ‹è¯•é…ç½®ç®¡ç†é¡µé¢
curl http://localhost:9999/
```

### éªŒè¯æ•°æ®åº“æŒä¹…åŒ–

```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh instance/database.db

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lt logs/ | head -5
```

## å¸¸è§é—®é¢˜

### 1. å®¹å™¨æ— æ³•å¯åŠ¨

**é—®é¢˜**ï¼šå®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs pppoe-activation

# æ£€æŸ¥ /dev/ppp è®¾å¤‡
ls -l /dev/ppp

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a | grep pppoe-activation
```

### 2. æ— æ³•è®¿é—® Web ç•Œé¢

**é—®é¢˜**ï¼šæµè§ˆå™¨æ— æ³•è®¿é—®é…ç½®é¡µé¢

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo ufw allow 80/tcp
sudo ufw allow 8081/tcp
sudo ufw allow 9999/tcp
```

### 3. pppd æƒé™é—®é¢˜ï¼ˆé‡è¦ï¼‰

**é—®é¢˜**ï¼šæ‹¨å·å¤±è´¥ï¼Œæ—¥å¿—æ˜¾ç¤º"Permission denied"æˆ–"Operation not permitted"

**åŸå› åˆ†æ**ï¼š
pppd æ‹¨å·éœ€è¦ä¸¤ä¸ªå…³é”®æƒé™ï¼š
1. `/dev/ppp` è®¾å¤‡è®¿é—®æƒé™
2. ç½‘ç»œç®¡ç†æƒé™ï¼ˆåˆ›å»º VLAN å­æ¥å£ï¼‰

**è§£å†³æ–¹æ³•**ï¼š

#### æ–¹æ³• 1ï¼šæ£€æŸ¥å®¹å™¨å¯åŠ¨å‚æ•°

```bash
# æ£€æŸ¥å®¹å™¨æ˜¯å¦åŒ…å«å¿…è¦çš„å‚æ•°
docker inspect pppoe-activation --format='{{json .HostConfig}}' | python3 -m json.tool | grep -E "Devices|CapAdd"

# å¿…é¡»åŒ…å«ä»¥ä¸‹å‚æ•°ï¼š
# "Devices": ["/dev/ppp"]
# "CapAdd": ["NET_ADMIN"]
```

#### æ–¹æ³• 2ï¼šé‡æ–°å¯åŠ¨å®¹å™¨ï¼ˆæ·»åŠ å¿…è¦å‚æ•°ï¼‰

```bash
# åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨
docker stop pppoe-activation
docker rm pppoe-activation

# é‡æ–°å¯åŠ¨å®¹å™¨ï¼ˆå¿…é¡»åŒ…å« --device=/dev/ppp å’Œ --cap-add=NET_ADMINï¼‰
docker run -d --name pppoe-activation \
  --restart=unless-stopped \
  --device=/dev/ppp \
  --cap-add=NET_ADMIN \
  -p 80:80 -p 8081:8081 -p 9999:9999 \
  -v ${PWD}/logs:/opt/pppoe-activation/logs \
  -v ${PWD}/data:/opt/pppoe-activation/data \
  -v ${PWD}/instance:/opt/pppoe-activation/instance \
  --network=host \
  pppoe-activation:latest
```

#### æ–¹æ³• 3ï¼šæ£€æŸ¥å®¹å™¨å†…çš„ /dev/ppp è®¾å¤‡

```bash
# æ£€æŸ¥å®¹å™¨å†…æ˜¯å¦æœ‰ /dev/ppp è®¾å¤‡
docker exec pppoe-activation ls -l /dev/ppp

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# crw-rw-rw- 1 root root 108, 0 Jan  1 00:00 /dev/ppp
# å¦‚æœä¸å­˜åœ¨ï¼Œè¯´æ˜å®¹å™¨å¯åŠ¨æ—¶ç¼ºå°‘ --device=/dev/ppp å‚æ•°
```

#### æ–¹æ³• 4ï¼šæ£€æŸ¥ pppd æƒé™

```bash
# åœ¨å®¹å™¨å†…æ£€æŸ¥ pppd å‘½ä»¤æƒé™
docker exec pppoe-activation which pppd

# åœ¨å®¹å™¨å†…æµ‹è¯• pppd æ˜¯å¦å¯ç”¨
docker exec pppoe-activation pppd --version

# å¦‚æœæ˜¾ç¤º"Permission denied"ï¼Œè¯´æ˜ç¼ºå°‘å¿…è¦çš„æƒé™
```

**éªŒè¯ä¿®å¤**ï¼š

```bash
# 1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼Œç¡®è®¤æ²¡æœ‰æƒé™é”™è¯¯
docker logs pppoe-activation | grep -i "permission\|denied"

# 2. æµ‹è¯•æ‹¨å·åŠŸèƒ½
# è®¿é—® http://æœåŠ¡å™¨IP:80/ è¿›è¡Œæµ‹è¯•æ‹¨å·

# 3. æŸ¥çœ‹æ‹¨å·æ—¥å¿—
ls -lt logs/ | head -5
```

### 4. VLAN å­æ¥å£åˆ›å»ºå¤±è´¥

**é—®é¢˜**ï¼šæ—¥å¿—æ˜¾ç¤º"RTNETLINK answers: Network is down"

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥åŸºç¡€ç½‘å¡çŠ¶æ€
ip link show

# æ‰‹åŠ¨å¯åŠ¨ç‰©ç†ç½‘å¡
sudo ip link set enp7s0 up

# æ£€æŸ¥å®¹å™¨æ˜¯å¦æœ‰ NET_ADMIN æƒé™
docker inspect pppoe-activation | grep CapAdd

# å¿…é¡»åŒ…å« "NET_ADMIN"
```

### 5. æ•°æ®åº“æ–‡ä»¶æƒé™é—®é¢˜

**é—®é¢˜**ï¼šå®¹å™¨æ— æ³•è®¿é—®æ•°æ®åº“

**è§£å†³æ–¹æ³•**ï¼š
```bash
# ä¿®æ”¹æ•°æ®åº“æ–‡ä»¶æƒé™
chmod 666 instance/database.db

# é‡å¯å®¹å™¨
docker restart pppoe-activation
```

### 5. å®¹å™¨é‡å¯åæ•°æ®ä¸¢å¤±

**é—®é¢˜**ï¼šé‡å¯åé…ç½®ä¸¢å¤±

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥æŒä¹…åŒ–ç›®å½•
ls -la logs/ instance/ data/

# æ£€æŸ¥å®¹å™¨æŒ‚è½½
docker inspect pppoe-activation | grep Mounts
```

### 6. /dev/ppp è®¾å¤‡ä¸å­˜åœ¨

**é—®é¢˜**ï¼šå®¿ä¸»æœºæ²¡æœ‰ /dev/ppp è®¾å¤‡

**è§£å†³æ–¹æ³•**ï¼š

#### æ–¹æ³• 1ï¼šåŠ è½½ PPP å†…æ ¸æ¨¡å—

```bash
# åŠ è½½ PPP å†…æ ¸æ¨¡å—
sudo modprobe ppp_async
sudo modprobe ppp_generic

# éªŒè¯æ¨¡å—æ˜¯å¦åŠ è½½
lsmod | grep ppp

# æ£€æŸ¥ /dev/ppp æ˜¯å¦åˆ›å»º
ls -l /dev/ppp
```

#### æ–¹æ³• 2ï¼šæ‰‹åŠ¨åˆ›å»º /dev/ppp è®¾å¤‡

```bash
# åˆ›å»º /dev/ppp è®¾å¤‡
sudo mknod /dev/ppp c 108 0

# è®¾ç½®æƒé™
sudo chmod 666 /dev/ppp

# éªŒè¯è®¾å¤‡
ls -l /dev/ppp
```

#### æ–¹æ³• 3ï¼šè®¾ç½®å¼€æœºè‡ªåŠ¨åŠ è½½

```bash
# åˆ›å»ºæ¨¡å—åŠ è½½é…ç½®
echo -e "ppp_async\nppp_generic" | sudo tee /etc/modules-load.d/ppp.conf

# é‡å¯åéªŒè¯
sudo reboot
# é‡å¯åæ£€æŸ¥
ls -l /dev/ppp
```

**éªŒè¯ä¿®å¤**ï¼š

```bash
# 1. ç¡®è®¤å®¿ä¸»æœºæœ‰ /dev/ppp è®¾å¤‡
ls -l /dev/ppp

# 2. ç¡®è®¤å®¹å™¨å¯åŠ¨æ—¶æ˜ å°„äº† /dev/ppp
docker inspect pppoe-activation --format='{{json .HostConfig.Devices}}' | python3 -m json.tool

# 3. ç¡®è®¤å®¹å™¨å†…æœ‰ /dev/ppp è®¾å¤‡
docker exec pppoe-activation ls -l /dev/ppp
```

## ç»´æŠ¤å’Œç®¡ç†

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®¹å™¨æ—¥å¿—
docker logs -f pppoe-activation

# æ‹¨å·æ—¥å¿—
ls -lt logs/

# å®æ—¶ç›‘æ§æ‹¨å·æ—¥å¿—
tail -f logs/pppoe_*.log
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯å®¹å™¨
docker restart pppoe-activation

# æŸ¥çœ‹é‡å¯åçŠ¶æ€
docker ps | grep pppoe-activation
```

### å¤‡ä»½å’Œæ¢å¤

```bash
# å¤‡ä»½
./backup.sh

# æ¢å¤
./restore.sh /tmp/pppoe-backup-20260201_120000
```

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ [`BACKUP_README.md`](BACKUP_README.md:1)ã€‚

## ç¦»çº¿éƒ¨ç½²å®Œæ•´æµç¨‹

æœ¬ç« èŠ‚è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨å®Œå…¨æ²¡æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸‹éƒ¨ç½² PPPOE æ¿€æ´»ç³»ç»Ÿã€‚

### å‡†å¤‡é˜¶æ®µï¼ˆåœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šï¼‰

#### 1. å‡†å¤‡ Docker é•œåƒ

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/hicool-ml/pppoe-activation.git
cd pppoe-activation

# 2. æ„å»ºé•œåƒ
docker build -t pppoe-activation:latest .

# 3. å¯¼å‡ºé•œåƒä¸º tar æ–‡ä»¶
docker save -o pppoe-activation-image.tar pppoe-activation:latest

# 4. æŸ¥çœ‹æ–‡ä»¶å¤§å°
ls -lh pppoe-activation-image.tar
```

#### 2. å‡†å¤‡æºä»£ç åŒ…

```bash
# 1. æ‰“åŒ…æºä»£ç 
tar -czf pppoe-activation-source.tar.gz pppoe-activation/

# 2. æŸ¥çœ‹æ–‡ä»¶å¤§å°
ls -lh pppoe-activation-source.tar.gz
```

#### 3. å‡†å¤‡ Docker å®‰è£…åŒ…ï¼ˆå¯é€‰ï¼‰

å¦‚æœç›®æ ‡æœºå™¨æ— æ³•è®¿é—®ç½‘ç»œï¼Œéœ€è¦å‡†å¤‡ Docker å®‰è£…åŒ…ï¼š

```bash
# Ubuntu/Debian
# ä¸‹è½½ Docker DEB åŒ…
wget https://download.docker.com/linux/ubuntu/dists/focal/pool/stable/amd64/docker-ce-cli_24.0.7-1~ubuntu.20.04~focal_amd64.deb
wget https://download.docker.com/linux/ubuntu/dists/focal/pool/stable/amd64/containerd.io_1.6.24-1_amd64.deb
wget https://download.docker.com/linux/ubuntu/dists/focal/pool/stable/amd64/docker-ce_24.0.7-1~ubuntu.20.04~focal_amd64.deb

# æ‰“åŒ…æ‰€æœ‰ DEB æ–‡ä»¶
mkdir docker-packages
mv *.deb docker-packages/
tar -czf docker-packages.tar.gz docker-packages/
```

#### 4. åˆ›å»ºå®Œæ•´éƒ¨ç½²åŒ…

```bash
# åˆ›å»ºéƒ¨ç½²ç›®å½•
mkdir pppoe-deployment
cd pppoe-deployment

# å¤åˆ¶æ‰€æœ‰æ–‡ä»¶
cp ../pppoe-activation-image.tar .
cp ../pppoe-activation-source.tar.gz .
cp ../docker-packages.tar.gz .

# åˆ›å»ºéƒ¨ç½²è„šæœ¬
cat > deploy.sh << 'EOF'
#!/bin/bash
set -e

echo "========================================="
echo "PPPOE æ¿€æ´»ç³»ç»Ÿ - ç¦»çº¿éƒ¨ç½²è„šæœ¬"
echo "========================================="
echo ""

# æ£€æŸ¥æ˜¯å¦ä¸º root ç”¨æˆ·
if [ "$EUID" -ne 0 ]; then 
    echo "è¯·ä½¿ç”¨ root æƒé™è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# 1. å®‰è£… Dockerï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
if ! command -v docker &> /dev/null; then
    echo "æ­£åœ¨å®‰è£… Docker..."
    
    # è§£å‹ Docker å®‰è£…åŒ…
    if [ -f docker-packages.tar.gz ]; then
        tar -xzf docker-packages.tar.gz
        cd docker-packages
        dpkg -i *.deb
        cd ..
        echo "Docker å®‰è£…å®Œæˆï¼"
    else
        echo "æœªæ‰¾åˆ° Docker å®‰è£…åŒ…ï¼Œè¯·æ‰‹åŠ¨å®‰è£… Docker"
        exit 1
    fi
else
    echo "Docker å·²å®‰è£…ï¼Œè·³è¿‡å®‰è£…æ­¥éª¤"
fi

# 2. å¯åŠ¨ Docker æœåŠ¡
echo "å¯åŠ¨ Docker æœåŠ¡..."
systemctl start docker
systemctl enable docker

# 3. å¯¼å…¥ Docker é•œåƒ
echo "å¯¼å…¥ Docker é•œåƒ..."
if [ -f pppoe-activation-image.tar ]; then
    docker load -i pppoe-activation-image.tar
    echo "Docker é•œåƒå¯¼å…¥å®Œæˆï¼"
else
    echo "æœªæ‰¾åˆ° Docker é•œåƒæ–‡ä»¶"
    exit 1
fi

# 4. è§£å‹æºä»£ç 
echo "è§£å‹æºä»£ç ..."
if [ -f pppoe-activation-source.tar.gz ]; then
    tar -xzf pppoe-activation-source.tar.gz
    cd pppoe-activation
    echo "æºä»£ç è§£å‹å®Œæˆï¼"
else
    echo "æœªæ‰¾åˆ°æºä»£ç æ–‡ä»¶"
    exit 1
fi

# 5. åˆ›å»ºæŒä¹…åŒ–ç›®å½•
echo "åˆ›å»ºæŒä¹…åŒ–ç›®å½•..."
mkdir -p logs data instance

# 6. å¯åŠ¨å®¹å™¨
echo "å¯åŠ¨å®¹å™¨..."
docker run -d --name pppoe-activation \
  --restart=unless-stopped \
  --device=/dev/ppp \
  --cap-add=NET_ADMIN \
  -p 80:80 \
  -p 8081:8081 \
  -p 9999:9999 \
  -v $(pwd)/logs:/opt/pppoe-activation/logs \
  -v $(pwd)/data:/opt/pppoe-activation/data \
  -v $(pwd)/instance:/opt/pppoe-activation/instance \
  --network=host \
  pppoe-activation:latest

# 7. ç­‰å¾…å®¹å™¨å¯åŠ¨
echo "ç­‰å¾…å®¹å™¨å¯åŠ¨..."
sleep 5

# 8. æ£€æŸ¥å®¹å™¨çŠ¶æ€
echo "æ£€æŸ¥å®¹å™¨çŠ¶æ€..."
docker ps | grep pppoe-activation

echo ""
echo "========================================="
echo "éƒ¨ç½²å®Œæˆï¼"
echo "========================================="
echo ""
echo "è®¿é—®åœ°å€ï¼š"
echo "  ç”¨æˆ·æ¿€æ´»é¡µé¢: http://$(hostname -I | awk '{print $1}'):80/"
echo "  ç®¡ç†åå°: http://$(hostname -I | awk '{print $1}'):8081/"
echo "  é…ç½®ç®¡ç†: http://$(hostname -I | awk '{print $1}'):9999/"
echo ""
echo "é»˜è®¤è´¦å·ï¼š"
echo "  è¶…çº§ç®¡ç†å‘˜: root / root123"
echo "  æ™®é€šç®¡ç†å‘˜: admin / admin123"
echo ""
echo "è¯·è®¿é—®é…ç½®ç®¡ç†é¡µé¢è¿›è¡Œç½‘ç»œé…ç½®ï¼š"
echo "  http://$(hostname -I | awk '{print $1}'):9999/"
echo ""
EOF

chmod +x deploy.sh

# æ‰“åŒ…æ‰€æœ‰æ–‡ä»¶
cd ..
tar -czf pppoe-deployment.tar.gz pppoe-deployment/

echo "éƒ¨ç½²åŒ…åˆ›å»ºå®Œæˆï¼špppoe-deployment.tar.gz"
```

### éƒ¨ç½²é˜¶æ®µï¼ˆåœ¨ç›®æ ‡æœºå™¨ä¸Šï¼‰

#### æ–¹æ³• 1ï¼šä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. ä¼ è¾“éƒ¨ç½²åŒ…åˆ°ç›®æ ‡æœºå™¨
# ä½¿ç”¨ scpã€U ç›˜æˆ–å…¶ä»–æ–¹å¼

# 2. è§£å‹éƒ¨ç½²åŒ…
tar -xzf pppoe-deployment.tar.gz
cd pppoe-deployment

# 3. è¿è¡Œéƒ¨ç½²è„šæœ¬
sudo ./deploy.sh

# 4. ç­‰å¾…éƒ¨ç½²å®Œæˆ
# è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰éƒ¨ç½²æ­¥éª¤
```

#### æ–¹æ³• 2ï¼šæ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. å®‰è£… Dockerï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
sudo dpkg -i docker-packages/*.deb

# 2. å¯åŠ¨ Docker æœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# 3. å¯¼å…¥é•œåƒ
docker load -i pppoe-activation-image.tar

# 4. è§£å‹æºä»£ç 
tar -xzf pppoe-activation-source.tar.gz
cd pppoe-activation

# 5. åˆ›å»ºæŒä¹…åŒ–ç›®å½•
mkdir -p logs data instance

# 6. å¯åŠ¨å®¹å™¨
docker run -d --name pppoe-activation \
  --restart=unless-stopped \
  --device=/dev/ppp \
  --cap-add=NET_ADMIN \
  -p 80:80 \
  -p 8081:8081 \
  -p 9999:9999 \
  -v $(pwd)/logs:/opt/pppoe-activation/logs \
  -v $(pwd)/data:/opt/pppoe-activation/data \
  -v $(pwd)/instance:/opt/pppoe-activation/instance \
  --network=host \
  pppoe-activation:latest

# 7. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep pppoe-activation
```

### éªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep pppoe-activation

# 2. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs pppoe-activation

# 3. è®¿é—®é…ç½®é¡µé¢
# http://æœåŠ¡å™¨IP:9999
```

### æ–‡ä»¶ä¼ è¾“æ–¹å¼

#### ä½¿ç”¨ SCP

```bash
# åœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šæ‰§è¡Œ
scp pppoe-deployment.tar.gz user@target-server:/tmp/
```

#### ä½¿ç”¨ U ç›˜

```bash
# 1. å¤åˆ¶åˆ° U ç›˜
cp pppoe-deployment.tar.gz /media/usb/

# 2. åœ¨ç›®æ ‡æœºå™¨ä¸Šä» U ç›˜å¤åˆ¶
cp /media/usb/pppoe-deployment.tar.gz /tmp/
```

#### ä½¿ç”¨ HTTP æœåŠ¡å™¨

```bash
# åœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šå¯åŠ¨ HTTP æœåŠ¡å™¨
cd /path/to/deployment
python3 -m http.server 8000

# åœ¨ç›®æ ‡æœºå™¨ä¸Šä¸‹è½½
wget http://source-server-ip:8000/pppoe-deployment.tar.gz
```

### ç¦»çº¿éƒ¨ç½²ä¼˜åŠ¿

- âœ… **æ— éœ€ç½‘ç»œ**ï¼šå®Œå…¨ç¦»çº¿ç¯å¢ƒéƒ¨ç½²
- âœ… **å¿«é€Ÿéƒ¨ç½²**ï¼šæ— éœ€ä¸‹è½½ä¾èµ–ï¼Œéƒ¨ç½²é€Ÿåº¦å¿«
- âœ… **ç‰ˆæœ¬å¯æ§**ï¼šä½¿ç”¨å›ºå®šç‰ˆæœ¬çš„é•œåƒå’Œæºä»£ç 
- âœ… **å®‰å…¨å¯é **ï¼šé¿å…ç½‘ç»œä¼ è¾“ä¸­çš„å®‰å…¨é£é™©
- âœ… **é€‚åˆå†…ç½‘**ï¼šé€‚åˆå†…ç½‘ç¯å¢ƒéƒ¨ç½²

### ç¦»çº¿éƒ¨ç½²æ³¨æ„äº‹é¡¹

1. **ç³»ç»Ÿå…¼å®¹æ€§**ï¼šç¡®ä¿ç›®æ ‡æœºå™¨çš„æ“ä½œç³»ç»Ÿä¸ Docker é•œåƒå…¼å®¹
2. **ç¡¬ä»¶è¦æ±‚**ï¼šç¡®ä¿ç›®æ ‡æœºå™¨æ»¡è¶³æœ€ä½ç¡¬ä»¶è¦æ±‚
3. **æ–‡ä»¶å®Œæ•´æ€§**ï¼šä¼ è¾“åéªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼ˆä½¿ç”¨ md5sumï¼‰
4. **æƒé™é—®é¢˜**ï¼šä½¿ç”¨ root æƒé™è¿è¡Œéƒ¨ç½²è„šæœ¬
5. **é˜²ç«å¢™é…ç½®**ï¼šç¡®ä¿é˜²ç«å¢™å…è®¸å¿…è¦çš„ç«¯å£ï¼ˆ80ã€8081ã€9999ï¼‰

## ä¸‹ä¸€æ­¥

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. è®¿é—®ç”¨æˆ·æ¿€æ´»é¡µé¢è¿›è¡Œæµ‹è¯•
2. è®¿é—®ç®¡ç†åå°æŸ¥çœ‹æ¿€æ´»æ—¥å¿—
3. æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ç½‘ç»œé…ç½®
4. é…ç½®å®šæœŸå¤‡ä»½ä»»åŠ¡
5. ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 

## æ›´æ–°æ—¥å¿—

- **2026-02-01**ï¼šæ·»åŠ ç¦»çº¿éƒ¨ç½²å®Œæ•´æµç¨‹ï¼Œæ”¯æŒæœ¬åœ°é•œåƒå’Œæºä»£ç éƒ¨ç½²
- **2026-02-01**ï¼šæ·»åŠ è‡ªåŠ¨å¯ç”¨ç½‘å¡åŠŸèƒ½ï¼Œä¿®å¤å®¹å™¨é‡å¯åæ— æ³•å¯åŠ¨çš„é—®é¢˜
- **2026-01-30**ï¼šå®ç°æ­£ç¡®çš„å¹¶å‘æ¨¡å‹ï¼Œæ”¯æŒå¤šç§ VLAN ID æ ¼å¼
- **2026-01-26**ï¼šDocker é•œåƒä¼˜åŒ–ï¼Œå‡å°‘é•œåƒå¤§å° 75-80%
