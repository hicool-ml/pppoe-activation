<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¿€æ´»æ—¥å¿— - PPPoEç®¡ç†</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 60px; }
        .log-row-cdu    { background-color: #4B556322; }
        .log-row-cmccgx { background-color: #FF450022; }
        .log-row-96301  { background-color: #1E90FF22; }
        .log-row-10010  { background-color: #32CD3222; }
        .log-row-unknown{ background-color: #CCCCCC22; }
        .table-hover tbody tr:hover { background-color: #f8f9fa; }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="/admin">ğŸ” ç®¡ç†åå°</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/admin">ä»ªè¡¨ç›˜</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="/admin/logs">æ—¥å¿—è®°å½•</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/config">ç³»ç»Ÿé…ç½®</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin_list">ç®¡ç†å‘˜ç®¡ç†</a>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/admin/logout">é€€å‡ºç™»å½•</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2 class="mb-4">ğŸ“‹ æ¿€æ´»æ—¥å¿—</h2>
    <a href="/admin" class="btn btn-secondary mb-3">è¿”å›ä»ªè¡¨ç›˜</a>
    
    <!-- å¯¼å‡ºæŒ‰é’®å’Œæ—¶é—´æ®µé€‰æ‹©å™¨ -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">å¯¼å‡ºæ—¥å¿—</h5>
            <div class="row align-items-end">
                <div class="col-md-4 mb-2">
                    <label for="startDate" class="form-label">å¼€å§‹æ—¶é—´</label>
                    <input type="datetime-local" class="form-control" id="startDate">
                </div>
                <div class="col-md-4 mb-2">
                    <label for="endDate" class="form-label">ç»“æŸæ—¶é—´</label>
                    <input type="datetime-local" class="form-control" id="endDate">
                </div>
                <div class="col-md-4 mb-2">
                    <button type="button" class="btn btn-primary w-100" onclick="exportLogs()">å¯¼å‡ºCSV</button>
                </div>
            </div>
            <small class="text-muted">å¦‚æœä¸é€‰æ‹©æ—¶é—´èŒƒå›´ï¼Œå°†å¯¼å‡ºæ‰€æœ‰æ—¥å¿—</small>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>å§“å</th>
                            <th>è§’è‰²</th>
                            <th>ISP</th>
                            <th>è´¦å·</th>
                            <th>çŠ¶æ€</th>
                            <th>IP</th>
                            <th>MAC</th>
                            <th>é”™è¯¯ç </th>
                            <th>æ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs.items %}
                        <tr class="{% if log.isp %}log-row-{{ log.isp }}{% else %}log-row-unknown{% endif %}">
                            <td>{{ log.name or 'N/A' }}</td>
                            <td>{{ log.role or 'N/A' }}</td>
                            <td>
                                {% set isp_name = ISP_DISPLAY.get(log.isp, 'æœªçŸ¥') %}
                                <span class="badge"
                                      style="background-color: {{ ISP_COLORS.get(isp_name, '#CCCCCC') }};">
                                    {{ isp_name }}
                                </span>
                            </td>
                            <td><code>{{ log.username }}</code></td>
                            <td>
                                <span class="badge {% if log.success %}bg-success{% else %}bg-danger{% endif %}">
                                    {{ 'æˆåŠŸ' if log.success else 'å¤±è´¥' }}
                                </span>
                            </td>
                            <td>{{ log.ip or 'N/A' }}</td>
                            <td><code>{{ log.mac or 'N/A' }}</code></td>
                            <td>{{ log.error_code or 'N/A' }}</td>
                            <td>{{ log.timestamp }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- åˆ†é¡µæ§ä»¶ -->
            {% if logs.total > 0 %}
            <nav aria-label="åˆ†é¡µå¯¼èˆª" class="mt-3">
                <ul class="pagination justify-content-center">
                    {% if logs.has_prev %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ logs.prev_num }}">ä¸Šä¸€é¡µ</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">ä¸Šä¸€é¡µ</span>
                    </li>
                    {% endif %}

                    {% for p in range(1, logs.pages + 1) %}
                    <li class="page-item {% if p == logs.page %}active{% endif %}">
                        {% if p == logs.page %}
                        <span class="page-link">{{ p }}</span>
                        {% else %}
                        <a class="page-link" href="?page={{ p }}">{{ p }}</a>
                        {% endif %}
                    </li>
                    {% endfor %}

                    {% if logs.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ logs.next_num }}">ä¸‹ä¸€é¡µ</a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">ä¸‹ä¸€é¡µ</span>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            <div class="text-center text-muted mt-2">
                ç¬¬ {{ logs.page }} é¡µï¼Œå…± {{ logs.pages }} é¡µï¼Œæ€»è®¡ {{ logs.total }} æ¡è®°å½•
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script src="/static/js/jquery.min.js"></script>
<script>
    function exportLogs() {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        
        let url = '/export_csv';
        const params = new URLSearchParams();
        
        if (startDate) {
            params.append('start', startDate);
        }
        if (endDate) {
            params.append('end', endDate);
        }
        
        if (params.toString()) {
            url += '?' + params.toString();
        }
        
        window.location.href = url;
    }
</script>
</body>
</html>
