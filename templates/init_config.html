<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿé…ç½® - PPPoEç®¡ç†</title>
    <style>
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
        }
        .form-wrapper {
            width: 100%;
            max-width: 1400px;
        }
        .tabs {
            display: flex;
            position: relative;
            z-index: 2;
            margin-bottom: 0;
        }
        .tab {
            padding: 14px 28px;
            background: #f1f3f5;
            cursor: pointer;
            border-radius: 12px 12px 0 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            color: #495057;
            border: none;
            position: relative;
            margin-right: 0;
            box-shadow: inset 0 -2px 4px rgba(0,0,0,0.05);
            text-decoration: none;
        }
        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: transparent;
            opacity: 0;
            transition: inherit;
        }
        .tab.active {
            background: white;
            color: #212529;
            box-shadow: none;
            transform: translateY(0);
            z-index: 3;
        }
        .tab.active::after {
            opacity: 1;
            bottom: 0;
            background: white;
            height: 2px;
        }
        .form-container {
            background: white;
            border-radius: 0 12px 12px 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
            z-index: 1;
            margin-top: 0;
            border-top: none;
        }
        .config-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .section-title {
            color: #212529;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }
        .hint {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            background: #fff;
        }
        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .interfaces-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .interface-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fff;
        }
        .interface-item:hover {
            border-color: #667eea;
            background-color: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .interface-item.selected {
            border-color: #667eea;
            background-color: #667eea;
            color: white;
        }
        .interface-item input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .interface-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
        }
        .interface-name {
            font-weight: 600;
            font-size: 15px;
        }
        .interface-status {
            font-size: 12px;
            margin-top: 4px;
        }
        .interface-item.selected .interface-status {
            color: rgba(255, 255, 255, 0.9);
        }
        .error {
            background-color: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        button {
            flex: 1;
            min-width: 200px;
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5568d3;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-success {
            background: #10b981;
            color: white;
        }
        .btn-success:hover {
            background: #059669;
        }
        .row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .col {
            flex: 1;
            min-width: 250px;
        }
    </style>
</head>
<body>
    <div class="form-wrapper">
        <div class="tabs">
            <a href="http://{{ request.host.split(':')[0] }}:8081/dashboard" class="tab">ğŸ“Š ä»ªè¡¨ç›˜</a>
            <a href="http://{{ request.host.split(':')[0] }}:8081/logs" class="tab">ğŸ“ æ¿€æ´»æ—¥å¿—</a>
            <a href="/config" class="tab active">âš™ï¸ ç³»ç»Ÿé…ç½®</a>
            <a href="http://{{ request.host.split(':')[0] }}:8081/admin_list" class="tab">ğŸ‘¥ ç®¡ç†å‘˜ç®¡ç†</a>
            <a href="http://{{ request.host.split(':')[0] }}:8081/logout" class="tab">ğŸšª ç™»å‡º</a>
        </div>
        
        <div class="form-container">
            {% if error %}
            <div class="error">
                <strong>é”™è¯¯ï¼š</strong>{{ error }}
            </div>
            {% endif %}
            
            <form method="POST" action="/save">
                <!-- ç½‘å¡é…ç½® -->
                <div class="config-card">
                    <div class="section-title">ğŸ“¡ ç½‘å¡é…ç½®</div>
                    <div class="form-group">
                        <label>ç½‘ç»œæ¨¡å¼ï¼š</label>
                        <div class="hint">é€‰æ‹©ç½‘ç»œæ¨¡å¼ï¼šç‰©ç†ç½‘å¡æˆ–VLANå­æ¥å£</div>
                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label>
                                        <input type="radio" name="net_mode" value="physical"
                                               {% if current_config.net_mode != 'vlan' %}checked{% endif %}
                                               onchange="toggleNetMode(this.value)">
                                        ç‰©ç†ç½‘å¡æ¨¡å¼
                                    </label>
                                    <div class="hint">ç›´æ¥ä½¿ç”¨ç‰©ç†ç½‘å¡ï¼ˆå¦‚ enp3s0ï¼‰</div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label>
                                        <input type="radio" name="net_mode" value="vlan"
                                               {% if current_config.net_mode == 'vlan' %}checked{% endif %}
                                               onchange="toggleNetMode(this.value)">
                                        VLANå­æ¥å£æ¨¡å¼
                                    </label>
                                    <div class="hint">åœ¨ç‰©ç†ç½‘å¡ä¸Šåˆ›å»ºVLANå­æ¥å£ï¼ˆå¦‚ enp3s0.100ï¼‰</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group" id="vlan_config_group" style="display: none;">
                            <label for="vlan_id">VLAN IDï¼š</label>
                            <input type="text" id="vlan_id" name="vlan_id" placeholder="ä¾‹å¦‚ï¼š2000 æˆ– 2000-2005 æˆ– 2000,2001,2002"
                                   value="{{ current_config.vlan_id if current_config.vlan_id else '' }}">
                            <div class="hint">æ”¯æŒæ ¼å¼ï¼šå•ä¸ªIDï¼ˆ2000ï¼‰ã€èŒƒå›´ï¼ˆ2000-2005ï¼‰ã€é€—å·åˆ†éš”ï¼ˆ2000,2001,2002ï¼‰æˆ–æ··åˆï¼ˆ2000,2002-2005,2007ï¼‰</div>
                        </div>
                        
                         <label>é€‰æ‹©å¯ç”¨çš„ç½‘å¡ï¼š</label>
                         <div class="hint" id="interface_hint">
                             ç³»ç»Ÿå·²æ£€æµ‹åˆ°ä»¥ä¸‹ç½‘å¡ï¼Œè¯·é€‰æ‹©ç”¨äºPPPoEæ‹¨å·çš„ç½‘å¡
                         </div>
                         <div class="interfaces-grid">
                            {% for iface in available_interfaces %}
                            <div class="interface-item"
                                 onclick="toggleInterface(this)">
                                <input type="checkbox" name="interfaces" value="{{ iface.name }}"
                                       {% if iface.name in current_config.interfaces %}checked{% endif %}>
                                <div class="interface-info">
                                    <span class="interface-name">{{ iface.name }}</span>
                                    {% if iface.status == 'DOWN' %}
                                    <span class="interface-status" style="color: #999;">(æœªå¯ç”¨)</span>
                                    {% else %}
                                    <span class="interface-status">{{ iface.ip_type }}: {{ iface.ip if iface.ip else 'æ— IP' }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- ç«¯å£é…ç½® -->
                <div class="config-card">
                    <div class="section-title">ğŸ”Œ ç«¯å£é…ç½®</div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="app_port">åº”ç”¨ç«¯å£ï¼š</label>
                                <input type="number" id="app_port" name="app_port"
                                       value="{{ current_config.app_port }}" min="1" max="65535">
                                <div class="hint">ç”¨æˆ·æ¿€æ´»æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤80ï¼Œå¯ç›´æ¥é€šè¿‡ http://ip è®¿é—®ï¼‰</div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label for="admin_port">ç®¡ç†ç«¯å£ï¼š</label>
                                <input type="number" id="admin_port" name="admin_port"
                                       value="{{ current_config.admin_port }}" min="1" max="65535">
                                <div class="hint">ç®¡ç†åå°ç«¯å£ï¼ˆé»˜è®¤8081ï¼Œå¯é€šè¿‡ http://ip:8081/dashboard è®¿é—®ï¼‰</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æŒä¹…åŒ–å­˜å‚¨é…ç½® -->
                <div class="config-card">
                    <div class="section-title">ğŸ’¾ æŒä¹…åŒ–å­˜å‚¨é…ç½®</div>
                    <div class="hint" style="margin-bottom: 20px;">
                        é…ç½®æ•°æ®æŒä¹…åŒ–è·¯å¾„ï¼Œç¡®ä¿å®¹å™¨é‡å¯åæ•°æ®ä¸ä¸¢å¤±ã€‚è·¯å¾„ç›¸å¯¹äºå®¿ä¸»æœºé¡¹ç›®ç›®å½•ã€‚
                    </div>
                    
                    <div class="form-group">
                        <label for="db_path">æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼š</label>
                        <input type="text" id="db_path" name="db_path"
                               value="{{ current_config.db_path }}">
                        <div class="hint">å­˜å‚¨æ¿€æ´»è®°å½•å’Œç®¡ç†å‘˜ä¿¡æ¯ï¼ˆé‡è¦ï¼ï¼‰</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="instance_path">å®ä¾‹ç›®å½•è·¯å¾„ï¼š</label>
                        <input type="text" id="instance_path" name="instance_path"
                               value="{{ current_config.instance_path }}">
                        <div class="hint">å­˜å‚¨æ•°æ®åº“å®ä¾‹æ–‡ä»¶ï¼ˆé‡è¦ï¼ï¼‰</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="logs_path">æ—¥å¿—ç›®å½•è·¯å¾„ï¼š</label>
                        <input type="text" id="logs_path" name="logs_path"
                               value="{{ current_config.logs_path }}">
                        <div class="hint">å­˜å‚¨PPPoEæ‹¨å·æ—¥å¿—</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="data_path">æ•°æ®ç›®å½•è·¯å¾„ï¼š</label>
                        <input type="text" id="data_path" name="data_path"
                               value="{{ current_config.data_path }}">
                        <div class="hint">å­˜å‚¨å…¶ä»–æ•°æ®æ–‡ä»¶</div>
                    </div>
                </div>
                
                <!-- æ—¶åŒºé…ç½® -->
                <div class="config-card">
                    <div class="section-title">ğŸŒ æ—¶åŒºé…ç½®</div>
                    <div class="form-group">
                        <label for="tz">æ—¶åŒºï¼š</label>
                        <input type="text" id="tz" name="tz"
                               value="{{ current_config.tz }}">
                        <div class="hint">ä¾‹å¦‚ï¼šAsia/Shanghai, America/New_York</div>
                    </div>
                </div>
                
                 <!-- æäº¤æŒ‰é’® -->
                 <div class="button-group">
                     <button type="button" class="btn-secondary" onclick="location.reload()">
                         ğŸ”„ åˆ·æ–°ç½‘å¡åˆ—è¡¨
                     </button>
                     <button type="button" class="btn-secondary" onclick="viewConfig()">
                         ğŸ‘ï¸ æŸ¥çœ‹å½“å‰é…ç½®
                     </button>
                     {% if current_config.is_super %}
                     <button type="submit" class="btn-success">
                         ğŸ’¾ ä¿å­˜é…ç½®å¹¶é‡å¯
                     </button>
                     {% else %}
                     <button type="button" class="btn-secondary" disabled style="opacity: 0.6; cursor: not-allowed;">
                         ğŸ”’ åªæœ‰è¶…çº§ç®¡ç†å‘˜æ‰èƒ½ä¿®æ”¹é…ç½®
                     </button>
                     {% endif %}
                 </div>
            </form>
        </div>
    </div>

    <script>
        function toggleInterface(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('selected', checkbox.checked);
        }
        
        function toggleNetMode(mode) {
            const vlanConfigGroup = document.getElementById('vlan_config_group');
            const interfaceHint = document.getElementById('interface_hint');
            if (mode === 'vlan') {
                vlanConfigGroup.style.display = 'block';
                interfaceHint.innerHTML = '<strong>VLAN æ¨¡å¼é…ç½®æµç¨‹ï¼š</strong>â‘  é€‰æ‹©ä¸€ä¸ªç‰©ç†ç½‘å¡ï¼ˆå¦‚ enp7s0ï¼‰â†’ â‘¡ æŒ‡å®š VLAN IDï¼ˆå¦‚ 2000-2005ï¼‰â†’ â‘¢ ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºæ‰€æœ‰ VLAN å­æ¥å£ â†’ â‘£ ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æ‰€æœ‰ VLAN å­æ¥å£å‚ä¸æ‹¨å·';
            } else {
                vlanConfigGroup.style.display = 'none';
                interfaceHint.innerHTML = 'ç³»ç»Ÿå·²æ£€æµ‹åˆ°ä»¥ä¸‹ç½‘å¡ï¼Œè¯·é€‰æ‹©ç”¨äºPPPoEæ‹¨å·çš„ç½‘å¡';
            }
        }

        // æŸ¥çœ‹å½“å‰é…ç½®
        function viewConfig() {
            fetch('/api/config')
                .then(response => response.json())
                .then(config => {
                    alert(`å½“å‰é…ç½®ï¼š\n\nç½‘å¡ï¼š${config.interfaces.join(', ')}\nåº”ç”¨ç«¯å£ï¼š${config.app_port}\nç®¡ç†ç«¯å£ï¼š${config.admin_port}\næ•°æ®åº“è·¯å¾„ï¼š${config.db_path}\nå®ä¾‹ç›®å½•ï¼š${config.instance_path}\næ—¥å¿—ç›®å½•ï¼š${config.logs_path}\næ•°æ®ç›®å½•ï¼š${config.data_path}\næ—¶åŒºï¼š${config.tz}`);
                })
                .catch(error => {
                    alert('è·å–é…ç½®å¤±è´¥ï¼š' + error);
                });
        }

        // åˆå§‹åŒ–é€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.interface-item input[type="checkbox"]').forEach(checkbox => {
            const parent = checkbox.closest('.interface-item');
            parent.classList.toggle('selected', checkbox.checked);
        });
        
        // åˆå§‹åŒ–ç½‘ç»œæ¨¡å¼æ˜¾ç¤ºçŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            const netModeRadios = document.querySelectorAll('input[name="net_mode"]');
            netModeRadios.forEach(radio => {
                if (radio.checked) {
                    toggleNetMode(radio.value);
                }
            });
        });
    </script>
</body>
</html>
